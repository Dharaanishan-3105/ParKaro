{% extends "base.html" %}

{% block title %}{{ location.name }} â€“ ParKaro{% endblock %}

{% block head_extra %}
  {% if location.latitude and location.longitude and GOOGLE_MAPS_API_KEY %}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}"></script>
    <script>
      function initMap() {
        var loc = { lat: {{ location.latitude }}, lng: {{ location.longitude }} };
        var map = new google.maps.Map(document.getElementById("map"), {
          zoom: 16,
          center: loc,
        });
        new google.maps.Marker({
          position: loc,
          map: map,
        });
      }
      window.onload = initMap;
    </script>
  {% endif %}
{% endblock %}

{% block content %}
  <div class="card">
    <h2>{{ location.name }}</h2>
    <p>{{ location.address }}</p>

    {% if location.latitude and location.longitude %}
      <div id="map" style="width: 100%; height: 300px; margin-bottom: 20px;"></div>
      <p>
        <a
          href="https://www.google.com/maps/dir/?api=1&destination={{ location.latitude }},{{ location.longitude }}"
          target="_blank"
          rel="noopener noreferrer"
        >
          Open directions in Google Maps
        </a>
      </p>
    {% endif %}
  </div>

    <h3>Slots</h3>
    <table>
      <tr>
        <th>Slot</th>
        <th>Status</th>
        <th>Vehicle Type</th>
        <th></th>
      </tr>
      {% for slot in slots %}
        <tr>
          <td>{{ slot.slot_code }}</td>
          <td>
            {% if slot.current_status == 'MAINTENANCE' %}
              Under maintenance
            {% elif slot.current_status == 'BOOKED' %}
              Booked
            {% else %}
              Available
            {% endif %}
          </td>
          <td>{{ slot.get_vehicle_type_allowed_display }}</td>
          <td>
            {% if slot.current_status == 'AVAILABLE' and user.is_authenticated %}
              <a class="btn-primary" href="{% url 'core:create_booking' location.id slot.id %}">Book</a>
            {% elif not user.is_authenticated and slot.current_status == 'AVAILABLE' %}
              <a class="btn-primary" href="{% url 'core:login' %}">Login to book</a>
            {% else %}
              <span class="muted">Not available</span>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="4" class="muted">No slots configured for this location.</td></tr>
      {% endfor %}
    </table>
{% endblock %}
